### 项目名称：RISC-V 操作系统中断处理

#### 项目概述：
这是一个基于 RISC-V 架构的简易操作系统，旨在演示任务调度和外部中断处理机制。在这个项目中，我们实现了一个基本的操作系统内核，支持任务的创建与调度，以及外部中断的处理。用户通过键盘输入触发外部中断，操作系统能够响应并切换任务。

#### 项目结构：
- `start.S`：系统启动代码，设置初始环境。
- `mem.S`：内存管理相关的汇编代码。
- `kernel.c`：操作系统核心代码，包含任务调度、内存管理等功能。
- `uart.c`：用于处理串口输入输出。
- `trap.c`：中断处理相关代码，负责处理外部中断。
- `page.c`：页面管理代码。
- `sched.c`：任务调度器，实现任务的创建和切换。
- `user.c`：用户级任务代码，模拟实际任务的执行。
- `plic.c`：处理外部中断的控制器代码。
- `Makefile`：编译和构建项目所需的配置文件。

#### 系统要求：
- 支持 RISC-V 架构的开发环境
- QEMU 模拟器
- RISC-V 工具链（如 riscv64-unknown-elf-gcc）

#### 编译与运行：
1. **编译项目**：
   在项目根目录下运行以下命令进行编译：
   ```
   make
   ```
   该命令会自动编译源代码并生成可执行文件 `os.elf`，然后将其转换为二进制文件 `os.bin`。

2. **运行操作系统**：
   使用 QEMU 模拟器运行编译后的操作系统：
   ```
   make run
   ```
   运行后，你将看到类似下面的输出：

   ```
   Press Ctrl-A and then X to exit QEMU
   ------------------------------------
   Hello, RVOS!
   HEAP_START = 0x800070e8(aligned to 0x80008000), HEAP_SIZE = 0x07ff8f18,
   num of reserved pages = 8, num of pages to be allocated for heap = 32752
   TEXT:   0x80000000 -> 0x800036c8
   RODATA: 0x800036c8 -> 0x80003a02
   DATA:   0x80004000 -> 0x80004004
   BSS:    0x80004010 -> 0x800070e8
   HEAP:   0x80010000 -> 0x88000000
   Task 0: Created!
   Task 0: Running...
   Task 1: Created!
   Task 1: Running...
   Task 0: Running...
   Task 1: Running...
   Task 0: Running...
   external interruption!
   c
   Task 1: Running...
   Task 0: Running...
   Task 1: Running...
   Task 0: Running...
   external interruption!
   a
   Task 1: Running...
   Task 0: Running...
   Task 1: Running...
   Task 0: Running...
   Task 1: Running...
   QEMU: Terminated
   ```

   每当你按下键盘字符（例如，`c`、`a`），操作系统会触发外部中断，并显示 `external interruption!`，表示中断被处理，系统会继续执行任务调度。

3. **退出 QEMU**：
   在 QEMU 模拟器中，你可以按 `Ctrl-A` 然后按 `X` 来退出 QEMU 模拟器。显示“QEMU: Terminated”。

#### 主要功能：
- **任务调度**：操作系统创建并调度两个任务（Task 0 和 Task 1）。这些任务会轮流执行，展示基本的任务调度机制。
- **外部中断处理**：用户通过键盘输入触发外部中断，操作系统能够处理中断并继续任务执行。
- **内存管理**：系统在初始化时进行内存管理配置，设置堆区和数据区，并进行任务内存分配。

#### 关键代码实现：
- **任务调度**：
  任务的创建和调度逻辑位于 `sched.c` 文件中。操作系统会根据任务的状态来切换执行，确保多个任务能够轮流运行。
  
- **中断处理**：
  外部中断由 `trap.c` 文件处理。当用户通过键盘输入触发中断时，系统会跳转到中断处理函数，并在处理完中断后继续执行任务调度。

#### 如何扩展：
1. **增加任务**：可以在 `sched.c` 中添加更多的任务，改进调度算法。
2. **增加中断类型**：目前系统只处理外部中断（键盘输入）。可以通过修改 `trap.c` 来支持更多类型的中断（如定时中断）。
3. **优化内存管理**：改进内存分配策略，支持动态内存分配和回收。

#### 问题排查：
1. **QEMU 不退出**：如果 QEMU 不退出，可以尝试按 `Ctrl-A` 然后按 `X` 来退出模拟器。如果 QEMU 仍然无法退出，检查是否有死循环或任务一直占用 CPU。
2. **程序无输出**：确保程序已正确编译，并且 `Makefile` 配置正确。如果在运行时没有看到输出，检查是否已启动 QEMU，或者增加调试输出以帮助定位问题。

#### 总结：
本项目展示了一个基本的 RISC-V 操作系统实现，重点关注任务调度和外部中断的处理。通过这个项目，您可以理解操作系统内核的基本结构和如何实现中断响应机制。如果您希望进一步扩展功能或优化系统，可以继续改进调度算法、中断处理机制和内存管理。